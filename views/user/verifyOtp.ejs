<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Verify OTP</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(180deg, #f7fbff, #ffffff);
      }
      .otp-card {
        max-width: 520px;
        margin: 4.5rem auto;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(20, 30, 60, 0.08);
      }
      .brand {
        font-size: 1.05rem;
        font-weight: 700;
        color: #0d6efd;
      }
      .otp-input {
        width: 56px;
        height: 56px;
        text-align: center;
        font-size: 1.25rem;
        border-radius: 8px;
        border: 1px solid #e6eef9;
      }
      .otp-input:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.06);
        outline: none;
      }
      .muted-small {
        font-size: 0.9rem;
        color: #6c757d;
      }
      @media (max-width: 420px) {
        .otp-input {
          width: 44px;
          height: 44px;
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="card otp-card p-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start mb-3">
          <div>
            <div class="brand">Mini Ecom</div>
            <h4 class="mt-2 mb-0">Verify your account</h4>
            <p class="muted-small mb-0">
              Enter the 6-digit code we sent to <strong><%= email %></strong>
            </p>
          </div>
          <div>
            <img
              src="/css/lock.svg"
              alt="lock"
              style="width: 28px; opacity: 0.8"
            />
          </div>
        </div>

        <!-- flash messages -->
        <% if (success_msg && success_msg.length) { %> <%
        success_msg.forEach(function(msg){ %>
        <div
          class="alert alert-success alert-dismissible fade show"
          role="alert"
        >
          <%= msg %>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>
        <% }) %> <% } %> <% if (error_msg && error_msg.length) { %> <%
        error_msg.forEach(function(msg){ %>
        <div
          class="alert alert-danger alert-dismissible fade show"
          role="alert"
        >
          <%= msg %>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>
        <% }) %> <% } %>

        <form id="otpForm" action="/verify-otp" method="POST" class="mt-3">
          <input type="hidden" name="email" value="<%= email %>" />
          <input type="hidden" id="otpHidden" name="otp" />

          <div class="d-flex gap-2 justify-content-center mb-3" id="otpInputs">
            <input
              inputmode="numeric"
              pattern="[0-9]*"
              maxlength="1"
              class="form-control otp-input"
              data-index="0"
            />
            <input
              inputmode="numeric"
              pattern="[0-9]*"
              maxlength="1"
              class="form-control otp-input"
              data-index="1"
            />
            <input
              inputmode="numeric"
              pattern="[0-9]*"
              maxlength="1"
              class="form-control otp-input"
              data-index="2"
            />
            <input
              inputmode="numeric"
              pattern="[0-9]*"
              maxlength="1"
              class="form-control otp-input"
              data-index="3"
            />
            <input
              inputmode="numeric"
              pattern="[0-9]*"
              maxlength="1"
              class="form-control otp-input"
              data-index="4"
            />
            <input
              inputmode="numeric"
              pattern="[0-9]*"
              maxlength="1"
              class="form-control otp-input"
              data-index="5"
            />
          </div>

          <div class="d-grid gap-2">
            <button id="verifyBtn" type="submit" class="btn btn-primary btn-lg">
              Verify OTP
            </button>
            <button
              id="cancelBtn"
              type="button"
              onclick="location.href='/shop'"
              class="btn btn-outline-secondary"
            >
              Cancel
            </button>
          </div>
        </form>

        <div class="text-center mt-3">
          <small id="timerText" class="muted-small"
            >You can resend the code in <span id="seconds">60</span>s</small
          >
          <form id="resendForm" action="/resend-otp" method="POST" class="mt-2">
            <input type="hidden" name="email" value="<%= email %>" />
            <button
              id="resendBtn"
              type="submit"
              class="btn btn-sm btn-outline-warning"
              disabled
            >
              Resend code
            </button>
          </form>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/otpTimer.js"></script>
    // <script>
    //   // OTP input UX: move focus, handle paste
    //   (function () {
    //     const inputs = Array.from(document.querySelectorAll(".otp-input"));
    //     const otpHidden = document.getElementById("otpHidden");
    //     inputs[0].focus();

    //     inputs.forEach((input, idx) => {
    //       input.addEventListener("input", (e) => {
    //         const val = e.target.value.replace(/[^0-9]/g, "");
    //         e.target.value = val;
    //         if (val && idx < inputs.length - 1) inputs[idx + 1].focus();
    //       });

    //       input.addEventListener("keydown", (e) => {
    //         if (e.key === "Backspace" && !e.target.value && idx > 0) {
    //           inputs[idx - 1].focus();
    //         }
    //       });

    //       input.addEventListener("paste", (e) => {
    //         e.preventDefault();
    //         const paste = (e.clipboardData || window.clipboardData)
    //           .getData("text")
    //           .trim();
    //         const digits = paste
    //           .replace(/\D/g, "")
    //           .slice(0, inputs.length)
    //           .split("");
    //         digits.forEach((d, i) => (inputs[i].value = d));
    //         const next =
    //           digits.length >= inputs.length
    //             ? inputs[inputs.length - 1]
    //             : inputs[digits.length];
    //         if (next) next.focus();
    //       });
    //     });

    //     // On submit, combine
    //     document
    //       .getElementById("otpForm")
    //       .addEventListener("submit", function (e) {
    //         const code = inputs.map((i) => i.value || "").join("");
    //         otpHidden.value = code;
    //         if (code.length < inputs.length) {
    //           e.preventDefault();
    //           alert("Please enter the full 6-digit code");
    //         }
    //       });
    //   })();

    //   // Timer for resend (uses existing otpTimer.js if available, fallback implemented)
    //   (function () {
    //     let seconds = 60;
    //     const secondsEl = document.getElementById("seconds");
    //     const resendBtn = document.getElementById("resendBtn");
    //     const timerText = document.getElementById("timerText");

    //     function tick() {
    //       if (!secondsEl) return;
    //       if (seconds > 0) {
    //         secondsEl.textContent = seconds;
    //         resendBtn.disabled = true;
    //         seconds--;
    //         setTimeout(tick, 1000);
    //       } else {
    //         secondsEl.parentElement.textContent = "";
    //         resendBtn.disabled = false;
    //       }
    //     }
    //     tick();
    //   })();
    // </script>
  </body>
</html>
